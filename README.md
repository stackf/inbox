# Gmail Assistant Project

This project aims to manage Gmail inboxes with OpenAI Assistants. It processes emails, creates daily summaries, and allows interactive communication through Slack.

## Features

- **Handle-Inbox (HI) Assistant**: Processes unread emails every 15 minutes
- **Daily-Report (DARE) Assistant**: Creates daily summaries of important emails
- **Chat Assistant**: Provides interactive support through Slack

## Setup Instructions

### 1. Install Dependencies

```bash
# Install npm packages
yarn install

# Install Netlify CLI globally (if not already installed)
npm install -g netlify-cli
```

### 2. Create Required API Keys and Credentials

#### Gmail API
1. Create a project in the [Google Cloud Console](https://console.cloud.google.com/)
2. Enable the Gmail API for the project
3. Create OAuth 2.0 credentials (Client ID and Client Secret)
4. Obtain a refresh token using OAuth 2.0 flow

#### Slack API
1. Create a Slack App in the [Slack API Console](https://api.slack.com/apps)
2. Enable Bot Token Scopes for chat:write, im:history, channels:history
3. Install the app to your workspace and get the Bot User OAuth Token

#### Trello API
1. Get your API Key from [Trello's Developer API Keys page](https://trello.com/app-key)
2. Generate a token with the required permissions
3. Get the ID of your "Inbox" list in your Getting Things Done board

#### OpenAI API
1. Get an API key from [OpenAI's platform](https://platform.openai.com/)

### 3. Setup Environment Variables

Create a `.env` file with the following variables:

```
# Gmail
VITE_GMAIL_CLIENT_ID=your_client_id
GMAIL_CLIENT_SECRET=your_client_secret
GMAIL_REFRESH_TOKEN=your_refresh_token

# Slack
SLACK_BOT_TOKEN=your_slack_bot_token
SLACK_BOT_USER_ID=your_slack_bot_user_id
SLACK_REPORT_CHANNEL_ID=your_slack_channel_id
SLACK_WEBHOOK_URL=your_slack_webhook_url

# Trello
TRELLO_API_KEY=your_trello_api_key
TRELLO_API_TOKEN=your_trello_api_token
TRELLO_INBOX_LIST_ID=your_trello_list_id

# OpenAI
OPENAI_API_KEY=your_openai_api_key
HI_OPENAI_ASSISTANT_ID=your_hi_assistant_id # Generated by setup-assistants
DARE_OPENAI_ASSISTANT_ID=your_dare_assistant_id # Generated by setup-assistants
CHAT_OPENAI_ASSISTANT_ID=your_chat_assistant_id # Generated by setup-assistants

# Setup
BASE_URL=http://localhost:8888 # In development
```

### 4. Create Gmail Labels

Create the following labels in your Gmail account:
- `processed by HI`
- `to-summarize`
- `archive-in-3-days`

### 5. Start Development Server

```bash
# Start the Netlify development server
netlify dev
```

### 6. Setup OpenAI Assistants

Make a POST request to initialize or update the OpenAI Assistants:

```bash
curl -X POST "http://localhost:8888/.netlify/functions/setup-assistants"
```

This will create three assistants:
- Handle-Inbox (HI)
- Daily-Report (DARE)
- Chat

The function will output the assistant IDs, which will be stored automatically as environment variables for future runs.

## Architecture

### Assistants and Their Tools

The project uses three OpenAI Assistants:

1. **Handle-Inbox (HI)**: Processes emails without the "processed by HI" label
2. **Daily-Report (DARE)**: Creates summaries for emails labeled "to-summarize"
3. **Chat**: Provides interactive communication via Slack

### Component Architecture
- **Netlify Functions**: Serverless functions for tools and cron jobs
- **Gmail API**: Email processing and management
- **Slack API**: User notifications and interaction
- **Trello API**: Task management
- **OpenAI Assistants API**: AI-powered email processing and communication

For detailed tool documentation, see [Assistant Tools Documentation](./documentation/assistant-tools.md).

## Workflows

### Handle-Inbox (runs every 15 minutes)
The HI assistant processes emails in the inbox by:
- Archiving emails labeled with `archive-in-x-days` that are older than X days
- Forwarding emails with invoices to a bookkeeping email
- Labeling newsletters as `to-summarize` and `archive-in-3-days`
- Notifying about important emails via Slack with draft responses
- Categorizing notifications as urgent, important-not-urgent, or irrelevant
- Applying the `processed by HI` label to all processed emails

### Daily Report (runs daily at 19:00 Amsterdam time)
The DARE assistant creates summary reports by:
- Retrieving emails labeled `to-summarize` from the last 24 hours
- Creating HackerNews-style summaries for newsletters and notifications
- Extracting unsubscribe links for irrelevant notifications
- Posting the summary to a Slack channel

### Chat (on-demand via Slack)
The Chat assistant provides interactive support when the boss replies to messages in Slack:
- Updates system prompts based on feedback
- Creates Trello tasks for follow-up items
- Provides unsubscribe links
- Updates draft email responses
- Creates documentation for customer contacts and notification handling

## Deployment

To deploy to Netlify:

1. Connect your GitHub repository to Netlify
2. Configure the environment variables in Netlify's dashboard
3. Deploy using the Netlify UI or CLI:

```bash
netlify deploy --prod
```

4. After deployment, update the `BASE_URL` environment variable to your Netlify URL

## Development and Customization

The project can be extended in several ways:
- Add more sophisticated email classification
- Create additional assistants for specialized tasks
- Implement file attachment handling
- Extend Trello integration for more complex workflows

## Troubleshooting

Common issues:
- **Authentication errors**: Check your API keys and tokens
- **Missing labels**: Ensure the required Gmail labels exist
- **Function timeouts**: Long-running operations may exceed Netlify's timeout limits

For more help, check the logs in the Netlify dashboard or locally with `netlify dev --debug`.

